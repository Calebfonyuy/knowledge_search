<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>KnowledgeSearch</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

</head>

<body>
	<div class="container-fluid" id ="main-search-zone">
		<div class="row">
			<div class="col-lg-9 col-md-9 text-primary">
		        <h1 id="logo">KnowledgeSearch</h1>
			</div>
			<div class="col-lg-2 col-md-2 col-sm-8 col-xs-8 m-auto">
                <select class="w-100 btn btn-primary" name="language">
                  <option value="en">EN</option>
                  <option value="fr">FR</option>
              </select>
            </div>
		</div>
		<div class="col-12">
			<hr>
		</div>
        <form class="form col-12 row m-0" action="#" method="post" onsubmit="return mainSearch()">
			<div class="col-12 m-auto p-auto row">
	            <div class="col-lg-8 col-md-8 m-auto">
	                <input type="text" name="search-text0" id="search-text0" class="form-control text-center font-weight-bold border border-primary" required>
	            </div>
	            <div class="col-lg-5 col-md-5 m-auto p-3">
	                <button id="search-btn" class="btn btn-primary w-100">Rechercher</button>
	            </div>
				<div class="col-lg-8 col-md-8 m-auto">
		            <div class="quick-box p-5 bg-light">
						Genie Informatique
					</div>
					<div class="quick-box p-5 bg-light">
						G&eacute;nie M&eacute;canique
					</div>
					<div class="quick-box p-5 bg-light">
						Genie Industriel
					</div>
					<div class="quick-box p-5 bg-light">
						Genie Electrique
					</div>
					<div class="quick-box p-5 bg-light">
						Genie Telecommunication
					</div>
					<div class="quick-box p-5 bg-light">
						Genie Civil
					</div>
					<div class="quick-box p-5 bg-light">
						Genie Informatique
					</div>
					<div class="quick-box p-5 bg-light">
						Arts Numeriques
					</div>
					<div class="quick-box p-5 bg-light">
						Humanites Numeriques
					</div>
				</div>
	        </div>
        </form>
    </div>


    <div class="container-fluid" id="result-view" hidden="hidden">
        <div class="row">
            <div class="col-lg-9 col-md-9">&nbsp;</div>
            <div class="col-lg-2 col-md-2">
                <select class="form-control btn-outline-info" name="language">
                  <option value="en">EN</option>
                  <option value="fr">FR</option>
              </select>
            </div>
            <div class="col-12 mt-2 row">
                <div class="col-lg-3 col-md-3">
                    <h2 class="logo">KnowledgeSearch</h2>
                </div>
				<form class="col-lg-9 col-md-9 col-sm-12 row" action="#" method="post" onsubmit="initPageCount(); return searchItem()" id="submitable-form">
	                <div class="col-7 search-input">
	                    <input type="text" name="search-text" id="search-text" class="form-control" placeholder="Chercher ici">
	                </div>
	                <div class="col-5 search-action">
	                    <button class="btn btn-outline-info w-100" id="search-btn">Rechercher</button>
	                </div>
				</form>
            </div>
        </div>
		<div class="col-12">
			<hr>
		</div>
        <div class="row">
            <div class="col-lg-2 col-md-2 d-none d-lg-block">
                <ul class="list-group" id="sidebar">
                    <li class="list-group-item">Shorcut Item</li>
                    <li class="list-group-item">Shorcut Item</li>
                    <li class="list-group-item">Shorcut Item</li>
                </ul>
            </div>

            <div class="col-lg-7 m-auto border row">
				<div class="col-12" id="articles">

				</div>
				<div class="col-12 row" id="navigation">
					<button type="button" class="btn btn-secondary m-2 col-5 w-100" name="precedant" id="precedant">Pr&eacute;c&eacute;dant</button>
					<button type="button" class="btn btn-secondary m-2 col-5 w-100" name="suivant" id="suivant">Suivant</button>
				</div>
            </div>

            <div class="col-lg-2">
                <ul class="list-group" id="websites">
                    <li class="list-group-item">Shorcut site</li>
                    <li class="list-group-item">Shorcut site</li>
                    <li class="list-group-item">Shorcut site</li>
                </ul>
            </div>

            <div class="col-lg-2 col-md-2 d-block d-md-none">
                <ul class="list-group" id="sidebar">
                    <li class="list-group-item">Shorcut Item</li>
                    <li class="list-group-item">Shorcut Item</li>
                    <li class="list-group-item">Shorcut Item</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/bootstrap.min.js"></script>

	<script type="text/javascript">
		let search_word = "{{ search_word }}";
		let language = "{{ lang }}";
		console.log(search_word);
		console.log(language);
		let page_count = 1;
		$('select[name=language]').change(function () {
			$('select[name=language]').val($(this).val());
		});

		function mainSearch() {
			initPageCount();
			$('#main-search-zone').attr('hidden','hidden');
			$('#result-view').removeAttr('hidden');

			$('#search-text').val($('#search-text0').val());
			$('#submitable-form').submit();

			return false;
		}

		function initPageCount() {
			page_count =1;
		}

		$('#precedant').click(function () {
			if (page_count==1) {
				return;
			}
			page_count -=10;
			searchItem();
		});

		$('#suivant').click(function () {
			page_count +=10;
			searchItem();
		});

		function searchItem() {
			if ($('#search-text').val()=='') {
				return;
			}
			var url = "https://www.googleapis.com/customsearch/v1?key=AIzaSyCw0EESxZunzAw7MdViYwVbD51WBhC_B-I&cx=008459376045476562504%3Ai56qn30nuh7";
			var question = $("#search-text").val();

			$.ajax({
				url: url,
				method: "GET",
				data: {
					q: question,
					alt: "JSON",
					lr: "lang_"+$('select[name=language]').val(),
					start: page_count
				},
				success: function (data) {
					console.log(data);
					formatResults(data);
				},
				error: function (data) {
					responseText = JSON.parse(data.responseText);
					let code = responseText.error.code;
					let domain = responseText.error.errors[0].domain;
					let reason = responseText.error.errors[0].reason;
					let message = responseText.error.errors[0].message;
					$('#articles').html('<b>'+code+'</b><br>'+message+': '+domain+'<br>'+reason);
				}
			});

			return false;
		}

		function formatResults(results) {
			let html_value = '';
			for (i=0; i<results.items.length; i++) {
				const result = results.items[i];
				html_value += '<a href="'+result.link+'" class="text-dark"><div class="article">'+
					'<div class="title">'+
						result.htmlTitle+
					'</div>'+
					'<div class="link">'+
						result.link+
					'</div>'+
					'<div class="caption">'+
						result.htmlSnippet+
					'</div>'+
				'</div></a><div style="height: 10px;">&nbsp;</div>'
			}
			$('#articles').html(html_value);
		}

		function getHTML(results){
            let html_value = '';
            var taille=0;
			for (i=0; i<results.items.length; i++) {
                const result = results.items[i];
                if(result.link.endsWith("/") || (result.link.endsWith(".html"))){
                    taille=taille+1;
                    html_value += '<a href="'+result.link+'" class="text-dark"><div class="article">'+
					'<div class="title">'+
						result.htmlTitle+
					'</div>'+
					'<div class="link">'+
						result.link+
					'</div>'+
					'<div class="caption">'+
                        result.htmlSnippet+
                    '</div>'+
				'</div></a><div style="height: 10px;">&nbsp;</div>'
                }
            }
            $('#taille').html(taille);
            $('#articles').html(html_value);
        }

	</script>
</body>

</html>
