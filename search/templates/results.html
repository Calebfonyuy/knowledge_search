{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>KnowledgeSearch</title>

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_result.css' %}">

    <style media="screen">

        html,
        body {
            height: 100%;
        }

        body {
            background-image: url("{% static 'images/image1.jpg' %}");
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
			background-attachment: fixed;
            
        }

        .suivant{
            visibility: hidden;
        }

        #nom{
            opacity: 1;
            color: blue; 
            font-size: 40px;
            padding: 3px;
            border: 1px solid;
            border-radius: 20px;
            box-shadow: 3px 3px teal;
            text-shadow:cyan;
            background-color:cyan;

        }
        .cv{
            position:absolute;
            border:5px solid rgba(255,255,255,0.1);
            box-shadow:inset 0 0 100px #4162a9;
            transform:translateZ(0);
        }
        .page-item{
            padding: 3px;
            border: 1px solid;
            border-radius: 10px;
        }
        
        #articles{
            visibility: hidden;
            width: 1000px;
            height: 450px;
            position: static;
            overflow: scroll;
        }
        .article {
            margin: 3px;
            padding: 2px;
            border: 1px solid;
            border-radius: 10px;
            box-shadow: 3px 3px teal;
            background-color:rgb(194, 194, 194);
        }

        .form-control{
            border-radius: 15px;
        }

        .article .title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .article .link {
            font-weight: lighter;
            color: #00F;
        }

        .article .caption {
            font-size: 0.9em;
        }
		a:hover{
			text-decoration: none;
		}
    </style>

</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-12">&nbsp;</div>
            <div class="col-12 row">
                <div class="d-flex justify-content-center col-10">
                    <p id="nom" class="row justify-content-center align-self-center">KnowledgeSearch</p>
                </div>
                
                <div class="col-1">
                <select class="form-control btn-outline-info" name="language" id="language">
                  <option value="en">EN</option>
                  <option value="fr">FR</option>
                </select>
                </div>
            </div>
            <div class="col-12 row">
                
                
                <!--
            <form class="form col-12 row m-0" action="#" method="post" onsubmit=" return mainSearch()">
                <div class="col-12 m-auto p-auto row">
                    <div class = "col-8 m-auto p-auto row">
                     <div class="input-group mb-3" id="rechercher">
                       <input type="text" class="form-control" id="search-text0" placeholder="Cherchez ici">
                       <div class="input-group-append">
                         <button class="btn btn-outline-primary" type="submit" id="rond"><fa-icon [icon]="faSearch"></fa-icon></button>
                       </div>
                     </div>
                    </div>
                    
                </div>
            </form>
                <div class="col-3">
                    <h2 id="logo">KnowledgeSearch</h2>
                </div>-->
				<form class="col-12 row" action="#" method="post" onsubmit="return searchItem()">
	                <div class="col-10 search-input">
                        <input type="text" name="search-text" id="search-text" class="form-control" placeholder="Chercher ici">
                        <div class="input-group-append">
                             <button class="btn btn-outline-primary" type="submit" id="rond"><fa-icon [icon]="faSearch"></fa-icon></button>
                           </div>
	                </div>
	                <div class="col-2 search-action">
                        <button class="btn btn-outline-info w-100" id="search-btn">rechercher</fa-icon></button>
                    </div>
                </form>
            </div>
            <div class="col 12s">
                <hr>
            </div>
            
            <!--<div class="col-12">
                <nav class="col-lg-6 col-md-6 m-auto">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <a href="#web" class="nav-link active" role="tab" data-toggle="tab">
                                Web <span id="taille"></span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>-->
        </div>
        <div><canvas class="cv"></canvas></div>
        <div class="row">
            <div class="col-lg-8 m-auto border" id="articles">
            

            </div>

        </div>
        <div class="col-12">
                <div class="d-flex justify-content-center col-10">
                    <div>
                        <ul class="pagination pagination-lg" class="suivant">
                            <li class="page-item"><a class="page-link" href="#">&laquo;</a></li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item"><a class="page-link" href="#">&raquo;</a></li>
                        </ul>
                    </div>
                </div>
        </div>
        
        
    </div>

    <script src="{% static 'js/jquery-3.4.1.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>

    <script type="text/javascript">
    // Definition of constants needed for result requests. NE PAS MODIFIER
        const search_url = "/search"; // parameters: word, lang, source=result
        const words_url ="/words"; // parameters: word, lang
        const paginate_url = "/next_page"; // parameters: word, lang, size
        const source = "result";

    //Initiating of search values
        var search_term = "{{  }}";
        var language = "{{  }}";

        var   canvas = document.querySelector('canvas');
        var ctx = canvas.getContext('2d'),
        particles = [],
        patriclesNum = 500,
                w = 500,
                h = 500,
            colors = ['#f35d4f','#f36849','#c0d988','#6ddaf1','#f1e85b'];
        
        canvas.width = 500;
        canvas.height = 500;
        canvas.style.left = (window.innerWidth - 500)/2+'px';

        if(window.innerHeight>500)
        canvas.style.top = (window.innerHeight - 500)/2+'px';
        
        function Factory(){  
        this.x =  Math.round( Math.random() * w);
        this.y =  Math.round( Math.random() * h);
        this.rad = Math.round( Math.random() * 1) + 1;
        this.rgba = colors[ Math.round( Math.random() * 3) ];
        this.vx = Math.round( Math.random() * 3) - 1.5;
        this.vy = Math.round( Math.random() * 3) - 1.5;
        }
        
        function draw(){
        ctx.clearRect(0, 0, w, h);
        ctx.globalCompositeOperation = 'lighter';
        for(var i = 0;i < patriclesNum; i++){
            var temp = particles[i];
            var factor = 1;
            
            for(var j = 0; j<patriclesNum; j++){
            
            var temp2 = particles[j];
            ctx.linewidth = 0.5;
            
            if(temp.rgba == temp2.rgba && findDistance(temp, temp2)<50){
                ctx.strokeStyle = temp.rgba;
                ctx.beginPath();
                ctx.moveTo(temp.x, temp.y);
                ctx.lineTo(temp2.x, temp2.y);
                ctx.stroke();
                factor++;
            }
            }
            
            
            ctx.fillStyle = temp.rgba;
            ctx.strokeStyle = temp.rgba;
            
            ctx.beginPath();
            ctx.arc(temp.x, temp.y, temp.rad*factor, 0, Math.PI*2, true);
            ctx.fill();
            ctx.closePath();
            
            ctx.beginPath();
            ctx.arc(temp.x, temp.y, (temp.rad+5)*factor, 0, Math.PI*2, true);
            ctx.stroke();
            ctx.closePath();
            

            temp.x += temp.vx;
            temp.y += temp.vy;
            
            if(temp.x > w)temp.x = 0;
            if(temp.x < 0)temp.x = w;
            if(temp.y > h)temp.y = 0;
            if(temp.y < 0)temp.y = h;
        }
        }

        function findDistance(p1,p2){  
        return Math.sqrt( Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2) );
        }

        window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame    ||
                function( callback ){
                    window.setTimeout(callback, 1000 / 60);
                };
        })();

        (function init(){
        for(var i = 0; i < patriclesNum; i++){
            particles.push(new Factory);
        }
        })();

        (function loop(){
        draw();
        requestAnimFrame(loop);
        })();

		function searchItem() {
			if ($('#search-text').val()=='') {
				return;
			}
			var url = "https://www.googleapis.com/customsearch/v1?key=AIzaSyANOYyLjy2Yh_6tqmEFWF2ANAeNjYekOrg&cx=008459376045476562504%3Ai56qn30nuh7&q="+$("#search-text").val()+"&alt=JSON";

			$.ajax({
				url: url,
				method: "GET",
				success: function (data) {
					console.log(data.items);
					formatResults(data);
				},
				error: function (data) {
					responseText = JSON.parse(data.responseText);
					let code = responseText.error.code;
					let domain = responseText.error.errors[0].domain;
					let reason = responseText.error.errors[0].reason;
					let message = responseText.error.errors[0].message;
					$('#articles').html('<b>'+code+'</b><br>'+message+': '+domain+'<br>'+reason);
				}
			});

			return false;
		}

		function formatResults(results) {
			let html_value = '';
			for (i=0; i<results.items.length; i++) {
				const result = results.items[i];
				html_value += '<a href="'+result.link+'" class="text-dark"><div class="article">'+
					'<div class="title">'+
						result.htmlTitle+
					'</div>'+
					'<div class="link">'+
						result.link+
					'</div>'+
					'<div class="caption">'+
						result.htmlSnippet+
					'</div>'+
				'</div></a><div style="height: 10px;">&nbsp;</div>'
			}
			$('#articles').html(html_value);
        }
        function getHTML(results){
            let html_value = '';
            var taille=0;
			for (i=0; i<results.items.length; i++) {
                const result = results.items[i];
                if(result.link.endsWith("/") || (result.link.endsWith(".html"))){
                    taille=taille+1;
                    html_value += '<a href="'+result.link+'" class="text-dark"><div class="article">'+
					'<div class="title">'+
						result.htmlTitle+
					'</div>'+
					'<div class="link">'+
						result.link+
					'</div>'+
					'<div class="caption">'+
                        result.htmlSnippet+
                    '</div>'+
				'</div></a><div style="height: 10px;">&nbsp;</div>'
                }	
            }
            $('#taille').html(taille);
            $('#articles').html(html_value);
        }
        var last='';
        function localStore(){
            if (typeof(Storage) !== "undefined") {
                
                localStorage.setItem("lastname", "Smith");
                document.getElementById("result").innerHTML = localStorage.getItem("lastname");
            } else {
            // Sorry! No Web Storage support..
            }
        }
        $(function ()
{
    $('#btnSearch').show().click(function () { Search($("#txtSearchTerm").val(),0);});
    $('#lnkPrev').click(function () { Search($("#txtSearchTerm").val(),-1); });
    $('#lnkNext').click(function () { Search($("#txtSearchTerm").val(),1);  });
});
	</script>
</body>

</html>
